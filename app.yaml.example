# DigitalOcean App Platform Spec for MessageQuest PocketBase Server
# Copy this to app.yaml and update with your values

name: mq-server
region: nyc
services:
  - name: pocketbase
    dockerfile_path: Dockerfile
    source_dir: /
    github:
      branch: main
      deploy_on_push: true
      repo: YOUR_GITHUB_USERNAME/mq-server
    
    # Environment variables
    envs:
      # PocketBase settings
      - key: PB_ENCRYPTION_KEY
        value: "YOUR_32_CHAR_ENCRYPTION_KEY"
        type: SECRET
      
      # Apple Push Notification Service
      - key: APNS_KEY_ID
        value: "YOUR_APNS_KEY_ID"
        type: SECRET
      
      - key: APNS_TEAM_ID
        value: "YOUR_APPLE_TEAM_ID"
        type: SECRET
      
      - key: APNS_BUNDLE_ID
        value: "com.yourcompany.messagequest"
      
      - key: APNS_PRODUCTION
        value: "false"
      
      # Optional: External services
      - key: OPENAI_API_KEY
        value: "YOUR_OPENAI_KEY"
        type: SECRET
    
    # Instance size
    instance_size_slug: basic-xxs
    instance_count: 1
    
    # HTTP port
    http_port: 8090
    
    # Health check
    health_check:
      http_path: /api/health
      initial_delay_seconds: 10
      period_seconds: 10
      timeout_seconds: 5
      success_threshold: 1
      failure_threshold: 3
    
    # Routes
    routes:
      - path: /

# Database (managed by PocketBase SQLite)
# For production, consider adding a managed database:
# databases:
#   - name: mq-db
#     engine: PG
#     version: "14"
#     size: db-s-dev-database
#     num_nodes: 1